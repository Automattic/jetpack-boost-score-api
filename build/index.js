!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.BoostScoreApiLibrary=t():e.BoostScoreApiLibrary=t()}(self,(()=>(()=>{"use strict";var e={436:(e,t,r)=>{r.d(t,{h:()=>i});var o=r(723),s=r(714),n=r(755);const __=o.__;class i extends Error{constructor(e,t,r){super(),this.httpCode=e,this.body=t,this.parseError=r}get message(){switch(this.httpCode){case 403:return this.getRestApiErrorMessage();case 200:if(this.parseError)return(0,o.sprintf)(/* Translators: %s refers to a browser-supplied error message (hopefully already in the right language) */
__("Received invalid response while communicating with your WordPress site: %s","boost-score-api"),this.parseError.message)}return(0,o.sprintf)(/* Translators: %d refers to numeric HTTP error code */
__("HTTP %d error received while communicating with the server.","boost-score-api"),this.httpCode)}getDisplayBody(){return(0,n.O)(this.body)?JSON.stringify(this.body,null,"  "):(0,s.w)(this.body,"").substring(0,1e3)}getRestApiErrorMessage(){return __("Your site's REST API does not seem to be accessible. Jetpack Boost requires access to your REST API in order to receive site performance scores. Please make sure that your site's REST API is active and accessible, and try again.","boost-score-api")}}},215:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(723),s=r(436),n=r(213);const __=o.__;async function i(e,t,r,s=null,i){const c={method:e,mode:"cors",headers:{"X-WP-Nonce":i}};"post"!==e&&"delete"!==e||!s||(c.body=JSON.stringify(s),c.headers["Content-Type"]="application/json");const a=function(e,t){return t+n.K+n.L+e}(r,t);let u;try{u=await fetch(a,c)}catch(e){const t=c;delete t.body,delete t.headers["X-WP-Nonce"];const r={requestInitiator:window.location.href,requestUrl:a,requestArgs:t,originalErrorMessage:e.toString()};throw new Error((0,o.sprintf)(/* Translators: %s refers to a string representation of an error object containing useful debug information  */
__("An error occurred while trying to communicate with the site REST API. Extra debug info: %s","boost-score-api"),JSON.stringify(r)))}return u}async function c(e,t,r,o=null,n){const c=await i(e,t,r,o,n);let a,u;try{a=await c.text()}catch(e){throw new s.h(c.status,null,e)}try{u=JSON.parse(a)}catch(e){throw new s.h(c.status,a,e)}if(!c.ok)throw new s.h(c.status,u,null);return u}const a={get:function(e,t,r){return c("get",e,t,null,r)},post:function(e,t,r=null,o){return c("post",e,t,r,o)}}},213:(e,t,r)=>{r.d(t,{K:()=>o,L:()=>s});const o="jetpack-boost/v1",s=""},198:(e,t,r)=>{function o(e,t=void 0){if("number"==typeof e)return e;if("string"==typeof e){const t=parseFloat(e);if(!isNaN(t))return t}return t}r.d(t,{G:()=>o})},714:(e,t,r)=>{function o(e,t=void 0){return"string"==typeof e?e:e&&e.toString instanceof Function?e.toString():t}r.d(t,{w:()=>o})},755:(e,t,r)=>{function o(e){return!!e&&e instanceof Object&&!(e instanceof Array)}r.d(t,{O:()=>o})},456:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(723);const __=o.__;async function s({interval:e,callback:t,timeout:r,timeoutError:o}){let s,n;return new Promise(((i,c)=>{s=setTimeout((()=>{c(new Error(o||__("Timed out","boost-score-api")))}),r||12e4),n=setInterval((async()=>{try{await Promise.resolve(t(i))}catch(e){c(e)}}),e)})).finally((()=>{clearTimeout(s),clearInterval(n)}))}},95:(e,t,r)=>{function o(e,t){return e instanceof Error?e:"string"==typeof e||e instanceof String?new Error(e.toString()):e.message?new Error(e.message):t?new Error(t):new Error(JSON.stringify(e))}r.d(t,{g:()=>o})},723:e=>{e.exports=window.wp.i18n}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};r.r(o),r.d(o,{calculateDaysSince:()=>m,didScoresChange:()=>g,getScoreLetter:()=>w,getScoreMovementPercentage:()=>b,requestSpeedScores:()=>f,requestSpeedScoresHistory:()=>y});var s=r(723),n=r(215),i=r(198),c=r(714),a=r(755),u=r(456),l=r(95);const __=s.__,d=12e4,p=5e3;async function f(e=!1,t,r,o){const s=h(await n.A.post(t,e?"/speed-scores/refresh":"/speed-scores",{url:r},o));return s.scores?s.scores:await async function(e,t,r){return(0,u.A)({timeout:d,interval:p,timeoutError:__("Timed out while waiting for speed-score.","boost-score-api"),callback:async o=>{const s=h(await n.A.post(e,"/speed-scores",{url:t},r));s.scores&&o(s.scores)}})}(t,r,o)}async function y(e,t,r){const o=(new Date).getTime(),s=o-2592e6;return await n.A.post(e,"/speed-scores-history",{start:s,end:o},r)}function h(e){if(e.error){const t=__("An unknown error occurred while requesting metrics","boost-score-api");throw(0,l.g)(e.error,t)}if((0,a.O)(e.scores))return{status:"success",scores:{current:(0,a.O)(e.scores.current)?{mobile:(0,i.G)(e.scores.current.mobile,0),desktop:(0,i.G)(e.scores.current.desktop,0)}:{mobile:0,desktop:0},noBoost:(0,a.O)(e.scores.noBoost)?{mobile:(0,i.G)(e.scores.noBoost.mobile,0),desktop:(0,i.G)(e.scores.noBoost.desktop,0)}:null,isStale:!!e.scores.isStale}};const t=(0,c.w)(e.status);if(!t)throw new Error(__("Invalid response while requesting metrics","boost-score-api"));return{status:t}}function w(e,t){const r=(e+t)/2;return r>90?"A":r>75?"B":r>50?"C":r>35?"D":r>25?"E":"F"}function g(e){const t=e.current,r=e.noBoost;return null!=t&&null!=r&&(t.mobile!==r.mobile||t.desktop!==r.desktop)}function b(e){const t=e.current,r=e.noBoost;let o=0,s=0;if(null!==t&&null!==r){o=e.current.mobile+e.current.desktop,s=e.noBoost.mobile+e.noBoost.desktop;const t=o/s-1;return Math.round(100*t)}return 0}function m(e){const t=new Date(e),r=(new Date).valueOf()-t.valueOf();return Math.floor(r/864e5)}return o})()));